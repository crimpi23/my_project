<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Multiple Articles</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
	<div class="container">
		<h1>Article Price Search</h1>
		<form method="POST" action="/search">
			<label for="articles">Enter Articles and Quantities (one per line, separated by space):</label>
			<textarea id="articles" name="articles" rows="10" placeholder="Example:\n0XW105101\n03H133201N 2\n1231321313" required></textarea>
			<button type="submit">Search</button>
		</form>

		{% if auto_set_quantities %}
		<!-- Блок повідомлення про автоматично встановлену кількість -->
		<div class="info-message">
			<p>The following articles had no quantity specified. Their quantity has been automatically set to <strong>1</strong>:</p>
			<ul>
				{% for article in auto_set_quantities %}
				<li>{{ article }}</li>
				{% endfor %}
			</ul>
		</div>
		{% endif %}

		{% if grouped_results %}
		<div class="results">
			<h2>Search Results:</h2>
			<table>
				<thead>
					<tr>
						<th>Article</th>
						<th>Price</th>
						<th>Table</th>
						<th>Action</th>
					</tr>
				</thead>
				<tbody>
					{% for article, details in grouped_results.items() %}
					{% for detail in details %}
					<tr>
						{% if loop.index == 1 %}
						<td rowspan="{{ details|length }}" class="article-cell">{{ article }}</td>
						{% endif %}
						<td>{{ detail.price }}</td>
						<td>{{ detail.table_name }}</td>
						<td>
							<form method="POST" action="/add_to_cart" class="cart-form">
								<input type="hidden" name="article" value="{{ article }}">
								<input type="hidden" name="price" value="{{ detail.price }}">
								<input type="hidden" name="table_name" value="{{ detail.table_name }}">
								<input type="number" name="quantity" value="{{ quantities[article] }}" min="1" class="quantity-input">
								<button type="submit" class="cart-button">
									<i class="fas fa-shopping-cart"></i>
								</button>
							</form>
						</td>
					</tr>
					{% endfor %}
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% endif %}

		{% if missing_articles %}
		<div class="results">
			<h2>Missing Articles:</h2>
			<ul>
				{% for article in missing_articles %}
				<li>{{ article }}</li>
				{% endfor %}
			</ul>
		</div>
		{% endif %}

		{% if message %}
		<div class="results">
			<h2>{{ message }}</h2>
		</div>
		{% endif %}
	</div>

</body>
</html>
