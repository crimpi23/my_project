{% extends "base/admin_base.html" %}

{% block title %}{{ _('Upload Price List') }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="bi bi-upload"></i> {{ _('Upload Price List') }}</h1>
    <div class="page-actions">
        <a href="{{ url_for('admin_dashboard', token=token) }}" class="btn-back">
            <i class="bi bi-arrow-left"></i> {{ _('Back') }}
        </a>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBrandModal">
            <i class="bi bi-plus-circle"></i> {{ _('Add New Brand') }}
        </button>
    </div>
</div>

<!-- Upload Form -->
<div class="card mb-4">
    <div class="card-body">
        <form action="{{ url_for('upload_price_list', token=token) }}" method="post" enctype="multipart/form-data">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">{{ _('Select Existing Price List or Create New') }}</label>
                    <select class="form-select" id="table_name" name="table_name" onchange="toggleNewTable()">
                        {% for price_list in price_lists %}
                            <option value="{{ price_list[0] }}">{{ price_list[0] }}</option>
                        {% endfor %}
                        <option value="new">{{ _('Create New Price List') }}</option>
                    </select>
                </div>
                
                <div class="col-md-6" id="new_table_div" style="display: none;">
                    <label class="form-label">{{ _('New Price List Name') }}</label>
                    <input type="text" class="form-control" id="new_table_name" name="new_table_name" 
                           placeholder="{{ _('Enter new table name (lowercase, no spaces)') }}">
                    <small class="text-muted">{{ _('Use only lowercase letters, numbers, and underscores.') }}</small>
                </div>
            </div>
            
            <div class="row g-3 mt-2">
                <div class="col-md-6">
                    <label class="form-label">{{ _('Select Brand') }}</label>
                    <select class="form-select" id="brand_id" name="brand_id">
                        {% for brand in brands %}
                            <option value="{{ brand[0] }}">{{ brand[1] }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label">{{ _('Upload File') }}</label>
                    <input type="file" class="form-control" id="file" name="file" accept=".csv,.txt,.xlsx,.xls">
                    <small class="text-muted">{{ _('Supported formats') }}: CSV, TXT, XLSX, XLS</small>
                </div>
            </div>
            
            <div class="mt-4">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-upload"></i> {{ _('Upload Price List') }}
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Current Price Lists -->
<div class="card">
    <div class="card-header">
        <i class="bi bi-list-ul me-2"></i>{{ _('Current Price Lists') }}
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>{{ _('Table Name') }}</th>
                    <th>{{ _('Supplier') }}</th>
                    <th>{{ _('Delivery Time') }}</th>
                    <th>{{ _('Created') }}</th>
                    <th>{{ _('Last Updated') }}</th>
                    <th>{{ _('Actions') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for pl in price_lists_info %}
                <tr>
                    <td><strong>{{ pl.table_name }}</strong></td>
                    <td>{{ pl.supplier_name or '-' }}</td>
                    <td>{{ pl.delivery_time or '-' }}</td>
                    <td>{{ pl.created_at.strftime('%Y-%m-%d %H:%M') if pl.created_at else '-' }}</td>
                    <td>{{ pl.last_updated.strftime('%Y-%m-%d %H:%M') if pl.last_updated else '-' }}</td>
                    <td>
                        <a href="{{ url_for('manage_price_lists', token=token) }}" class="btn btn-sm btn-primary">
                            {{ _('Manage') }}
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add Brand Modal -->
<div class="modal fade" id="addBrandModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ _('Add New Brand') }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('add_brand', token=token) }}" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">{{ _('Brand Name') }}</label>
                        <input type="text" class="form-control" name="brand_name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ _('Cancel') }}</button>
                    <button type="submit" class="btn btn-primary">{{ _('Add') }}</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleNewTable() {
    var select = document.getElementById('table_name');
    var newDiv = document.getElementById('new_table_div');
    newDiv.style.display = select.value === 'new' ? 'block' : 'none';
}
document.addEventListener('DOMContentLoaded', toggleNewTable);
</script>
{% endblock %}
