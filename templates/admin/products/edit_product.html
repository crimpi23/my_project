{% extends "base/admin_base.html" %}

{% block title %}{% if is_new %}–î–æ–¥–∞—Ç–∏ –æ–ø–∏—Å{% else %}–†–µ–¥–∞–≥—É–≤–∞—Ç–∏{% endif %} - {{ article }} - {{ super() }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2>
                        <i class="bi bi-{% if is_new %}plus-circle{% else %}pencil{% endif %}"></i>
                        {% if is_new %}–î–æ–¥–∞—Ç–∏ –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É{% else %}–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä{% endif %}
                    </h2>
                    <p class="text-muted mb-0">
                        –ê—Ä—Ç–∏–∫—É–ª: <code class="fs-5">{{ article }}</code>
                        {% if stock_info %}
                        <span class="badge bg-{% if stock_info.quantity > 0 %}success{% else %}danger{% endif %} ms-2">
                            –ö—ñ–ª—å–∫—ñ—Å—Ç—å: {{ stock_info.quantity }}
                        </span>
                        <span class="badge bg-info ms-1">{{ "%.2f"|format(stock_info.price) }} ‚Ç¨</span>
                        {% endif %}
                    </p>
                </div>
                <div>
                    <a href="{{ url_for('admin_products_missing_descriptions', token=token) }}" class="btn btn-outline-secondary me-2">
                        <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É
                    </a>
                    <a href="https://www.google.com/search?q={{ article }}+Land+Rover+part" 
                       target="_blank" class="btn btn-outline-primary">
                        <i class="bi bi-google"></i> –®—É–∫–∞—Ç–∏ –≤ Google
                    </a>
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
            <form method="POST">
                <div class="row">
                    <!-- –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
                    <div class="col-lg-8">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-info-circle"></i> –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="brand_id" class="form-label">–ë—Ä–µ–Ω–¥</label>
                                        <select name="brand_id" id="brand_id" class="form-select">
                                            {% for brand in brands %}
                                            <option value="{{ brand.id }}" 
                                                {% if product and product.brand_id == brand.id %}selected{% endif %}
                                                {% if not product and stock_info and stock_info.brand_id == brand.id %}selected{% endif %}>
                                                {{ brand.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>

                                <!-- –¢–∞–±—É–ª—è—Ç–æ—Ä –º–æ–≤ -->
                                <ul class="nav nav-tabs" id="langTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="sk-tab" data-bs-toggle="tab" data-bs-target="#sk" type="button">
                                            üá∏üá∞ Slovensky
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="en-tab" data-bs-toggle="tab" data-bs-target="#en" type="button">
                                            üá¨üáß English
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="pl-tab" data-bs-toggle="tab" data-bs-target="#pl" type="button">
                                            üáµüá± Polski
                                        </button>
                                    </li>
                                </ul>
                                
                                <div class="tab-content p-3 border border-top-0 rounded-bottom" id="langTabsContent">
                                    <!-- –°–ª–æ–≤–∞—Ü—å–∫–∞ -->
                                    <div class="tab-pane fade show active" id="sk" role="tabpanel">
                                        <div class="mb-3">
                                            <label for="name_sk" class="form-label">–ù–∞–∑–≤–∞ (SK)</label>
                                            <input type="text" class="form-control" id="name_sk" name="name_sk" 
                                                   value="{{ product.name_sk if product else '' }}" 
                                                   placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Å–ª–æ–≤–∞—Ü—å–∫–æ—é">
                                        </div>
                                        <div class="mb-3">
                                            <label for="description_sk" class="form-label">–û–ø–∏—Å (SK)</label>
                                            <textarea class="form-control" id="description_sk" name="description_sk" 
                                                      rows="4" placeholder="–í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å —Å–ª–æ–≤–∞—Ü—å–∫–æ—é">{{ product.description_sk if product else '' }}</textarea>
                                        </div>
                                    </div>
                                    
                                    <!-- –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ -->
                                    <div class="tab-pane fade" id="en" role="tabpanel">
                                        <div class="mb-3">
                                            <label for="name_en" class="form-label">–ù–∞–∑–≤–∞ (EN)</label>
                                            <input type="text" class="form-control" id="name_en" name="name_en" 
                                                   value="{{ product.name_en if product else '' }}" 
                                                   placeholder="Enter name in English">
                                        </div>
                                        <div class="mb-3">
                                            <label for="description_en" class="form-label">–û–ø–∏—Å (EN)</label>
                                            <textarea class="form-control" id="description_en" name="description_en" 
                                                      rows="4" placeholder="Enter description in English">{{ product.description_en if product else '' }}</textarea>
                                        </div>
                                    </div>
                                    
                                    <!-- –ü–æ–ª—å—Å—å–∫–∞ -->
                                    <div class="tab-pane fade" id="pl" role="tabpanel">
                                        <div class="mb-3">
                                            <label for="name_pl" class="form-label">–ù–∞–∑–≤–∞ (PL)</label>
                                            <input type="text" class="form-control" id="name_pl" name="name_pl" 
                                                   value="{{ product.name_pl if product else '' }}" 
                                                   placeholder="Wpisz nazwƒô po polsku">
                                        </div>
                                        <div class="mb-3">
                                            <label for="description_pl" class="form-label">–û–ø–∏—Å (PL)</label>
                                            <textarea class="form-control" id="description_pl" name="description_pl" 
                                                      rows="4" placeholder="Wpisz opis po polsku">{{ product.description_pl if product else '' }}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ë—ñ—á–Ω–∞ –ø–∞–Ω–µ–ª—å -->
                    <div class="col-lg-4">
                        <!-- –î—ñ—ó -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-gear"></i> –î—ñ—ó</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="bi bi-check-lg"></i>
                                        {% if is_new %}–°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–ø–∏—Å{% else %}–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏{% endif %}
                                    </button>
                                    <a href="{{ url_for('admin_add_photos_to_product', token=token, article=article) }}" 
                                       class="btn btn-outline-success">
                                        <i class="bi bi-image"></i> –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑—ñ —Å–∫–ª–∞–¥—É -->
                        {% if stock_info %}
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-boxes"></i> –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑—ñ —Å–∫–ª–∞–¥—É</h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm mb-0">
                                    <tr>
                                        <td>–ë—Ä–µ–Ω–¥:</td>
                                        <td><strong>{{ stock_info.brand_name or 'N/A' }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td>–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</td>
                                        <td>
                                            <span class="badge bg-{% if stock_info.quantity > 0 %}success{% else %}danger{% endif %}">
                                                {{ stock_info.quantity }}
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>–¶—ñ–Ω–∞:</td>
                                        <td><strong>{{ "%.2f"|format(stock_info.price) }} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>–í–∞—Ä—Ç—ñ—Å—Ç—å:</td>
                                        <td>{{ "%.2f"|format(stock_info.price * stock_info.quantity) }} ‚Ç¨</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        {% endif %}

                        <!-- –®–≤–∏–¥–∫–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-lightning"></i> –®–≤–∏–¥–∫–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted small">–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤ —ñ–Ω—à—ñ –º–æ–≤–∏:</p>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="copyEnToAll()">
                                    <i class="bi bi-files"></i> –ö–æ–ø—ñ—é–≤–∞—Ç–∏ EN ‚Üí –≤—Å—ñ –º–æ–≤–∏
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function copyEnToAll() {
    const nameEn = document.getElementById('name_en').value;
    const descEn = document.getElementById('description_en').value;
    
    if (!nameEn && !descEn) {
        alert('–°–ø–æ—á–∞—Ç–∫—É –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é –º–æ–≤–æ—é!');
        return;
    }
    
    // –ö–æ–ø—ñ—é—î–º–æ –≤ —ñ–Ω—à—ñ –º–æ–≤–∏ (—è–∫—â–æ –ø–æ–ª—è –ø–æ—Ä–æ–∂–Ω—ñ)
    ['sk', 'pl'].forEach(lang => {
        const nameField = document.getElementById('name_' + lang);
        const descField = document.getElementById('description_' + lang);
        
        if (!nameField.value && nameEn) nameField.value = nameEn;
        if (!descField.value && descEn) descField.value = descEn;
    });
    
    alert('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! –¢–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∫–ª–∞—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∏.');
}
</script>
{% endblock %}
