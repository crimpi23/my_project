{% extends "admin_base.html" %}

{% block title %}Create News{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Create News</h1>
        <a href="{{ url_for('admin_news', token=token) }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to List
        </a>
    </div>

    <div class="card">
        <div class="card-body">
            <form method="POST" action="{{ url_for('create_news', token=token) }}">
                <div class="mb-3">
                    <label for="title" class="form-label">Title</label>
                    <input type="text" class="form-control" id="title" name="title" required>
                </div>

                <div class="mb-3">
                    <label for="content" class="form-label">Short Description</label>
                    <textarea class="form-control" id="content" name="content" rows="3" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="html_content" class="form-label">Full News Content</label>
                    <textarea id="html_content" name="html_content"></textarea>
                </div>

                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="is_published" name="is_published">
                    <label class="form-check-label" for="is_published">Publish Immediately</label>
                </div>

                <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-lg"></i> Create News
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- News Modal -->
<div class="modal fade" id="newsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.tiny.cloud/1/90oozl0f4oahclttjqyd22sjftlwfbyi2rpgre9dz2whorm6/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
tinymce.init({
    selector: '#html_content',
    height: 500,
    plugins: [
        'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
        'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
        'insertdatetime', 'media', 'table', 'help', 'wordcount'
    ],
    toolbar: 'undo redo | blocks | ' +
        'bold italic backcolor | alignleft aligncenter ' +
        'alignright alignjustify | bullist numlist outdent indent | ' +
        'removeformat | help',
    content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
});

function markAsRead(newsId) {
    fetch(`/{{ token }}/news/${newsId}/read`, {
        method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNewsDetails(newsId);
            location.reload();
        }
    });
}

function showNewsDetails(newsId) {
    fetch(`/{{ token }}/news/${newsId}`)
    .then(response => response.json())
    .then(data => {
        const modal = new bootstrap.Modal(document.getElementById('newsModal'));
        document.querySelector('#newsModal .modal-title').textContent = data.title;
        document.querySelector('#newsModal .modal-body').innerHTML = data.html_content;
        modal.show();
    });
}
</script>
{% endblock %}

{% block extra_css %}
<style>
.news-card {
    transition: transform 0.2s;
}
.news-card:hover {
    transform: translateY(-2px);
}
.news-card.unread {
    border-left: 4px solid #0d6efd;
}
.news-card.read {
    opacity: 0.8;
}
</style>
{% endblock %}
